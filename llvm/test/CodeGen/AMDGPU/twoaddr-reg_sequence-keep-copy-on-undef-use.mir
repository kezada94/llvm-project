# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py UTC_ARGS: --version 5
# RUN: llc -mtriple=amdgcn-amd-amdhsa -verify-machineinstrs -run-pass=twoaddressinstruction -o - %s | FileCheck %s

# Checks that REG_SEQUENCE lowering does not skip a COPY of an undef operand if that subregister 
# is used.

---
name:      reg_sequence-keep-copy-on-undef-use
noPhis:          true
body:             |
  bb.0:

    ; CHECK-LABEL: name: reg_sequence-keep-copy-on-undef-use
    ; CHECK: [[COPY:%[0-9]+]]:sgpr_32 = S_MOV_B32 0, implicit $exec
    ; CHECK-NEXT: undef [[DEF:%[0-9]+]].sub0:sreg_64 = COPY [[COPY]]
    ; CHECK-NEXT: [[DEF]].sub1:sreg_64 = COPY undef [[UDF:%[0-9]+]]:sgpr_32
    ; CHECK-NEXT: [[OTH:%[0-9]+]]:vgpr_32 = V_MOV_B32_e32 [[DEF]].sub1
    
    %0:sgpr_32 = S_MOV_B32  0, implicit $exec

    %3:sreg_64 = REG_SEQUENCE %0, %subreg.sub0, undef %2:sgpr_32, %subreg.sub1
    %12:vgpr_32 = V_MOV_B32_e32 %3.sub1, implicit $exec
...
